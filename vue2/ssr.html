<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>面试官：SSR解决了什么问题？有做过SSR吗？你是怎么做的？ | 我的前端资料库</title>
    <meta name="description" content="方便查看整理的前端资料，让工作和学习变得更轻松。">
    <link rel="preload stylesheet" href="/docs/assets/style.1712dc0b.css" as="style">
    <script type="module" src="/docs/assets/app.9afefd5c.js"></script>
    <link rel="preload" href="/docs/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
  <link rel="modulepreload" href="/docs/assets/chunks/framework.a7bfe727.js">
  <link rel="modulepreload" href="/docs/assets/chunks/theme.cd793e76.js">
  <link rel="modulepreload" href="/docs/assets/vue2_ssr.md.1045d2cb.lean.js">
  <link rel="icon" type="image/svg+xml" href="/docs/logo.svg">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-b2cf3e0b><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c8616af1></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c8616af1> Skip to content </a><!--]--><!----><header class="VPNav" data-v-b2cf3e0b data-v-7e5bc4a5><div class="VPNavBar has-sidebar" data-v-7e5bc4a5 data-v-1d30fa41><div class="container" data-v-1d30fa41><div class="title" data-v-1d30fa41><div class="VPNavBarTitle has-sidebar" data-v-1d30fa41 data-v-f4ef19a3><a class="title" href="/docs/" data-v-f4ef19a3><!--[--><!--]--><!--[--><img class="VPImage logo" src="/docs/logo.svg" alt data-v-6db2186b><!--]--><!--[-->我的前端资料库<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-1d30fa41><div class="curtain" data-v-1d30fa41></div><div class="content-body" data-v-1d30fa41><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-1d30fa41 data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-764effdf><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-764effdf><span class="text" data-v-764effdf><!----> 前端 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-764effdf><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-764effdf><div class="VPMenu" data-v-764effdf data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-d2c93bab><a class="VPLink link" href="/docs/css/" data-v-d2c93bab data-v-8f4dc553><!--[-->CSS<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-d2c93bab><a class="VPLink link" href="/docs/es6/" data-v-d2c93bab data-v-8f4dc553><!--[-->ES6<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-d2c93bab><a class="VPLink link" href="/docs/javascript/" data-v-d2c93bab data-v-8f4dc553><!--[-->JavaScript<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-d2c93bab><a class="VPLink link" href="/docs/typescript/" data-v-d2c93bab data-v-8f4dc553><!--[-->TypeScript<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-d2c93bab><a class="VPLink link active" href="/docs/vue2/" data-v-d2c93bab data-v-8f4dc553><!--[-->Vue2<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-d2c93bab><a class="VPLink link" href="/docs/vue3/" data-v-d2c93bab data-v-8f4dc553><!--[-->Vue3<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-d2c93bab><a class="VPLink link" href="/docs/react/" data-v-d2c93bab data-v-8f4dc553><!--[-->React<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-d2c93bab><a class="VPLink link" href="/docs/webpack/" data-v-d2c93bab data-v-8f4dc553><!--[-->Webpack<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-d2c93bab><a class="VPLink link" href="/docs/nodejs/" data-v-d2c93bab data-v-8f4dc553><!--[-->NodeJS<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/algorithm/" tabindex="0" data-v-7f418b0f data-v-37adc828 data-v-8f4dc553><!--[-->算法<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/design/" tabindex="0" data-v-7f418b0f data-v-37adc828 data-v-8f4dc553><!--[-->设计<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/git/" tabindex="0" data-v-7f418b0f data-v-37adc828 data-v-8f4dc553><!--[-->Git<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/linux/" tabindex="0" data-v-7f418b0f data-v-37adc828 data-v-8f4dc553><!--[-->Linux<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/applet/" tabindex="0" data-v-7f418b0f data-v-37adc828 data-v-8f4dc553><!--[-->小程序<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-1d30fa41 data-v-f6a63727><label title="toggle dark mode" data-v-f6a63727 data-v-a9c8afb8><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-a9c8afb8 data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-a9c8afb8><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-a9c8afb8><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-1d30fa41 data-v-40855f84 data-v-764effdf><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-764effdf><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-764effdf><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-764effdf><div class="VPMenu" data-v-764effdf data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-40855f84><div class="item appearance" data-v-40855f84><p class="label" data-v-40855f84>Appearance</p><div class="appearance-action" data-v-40855f84><label title="toggle dark mode" data-v-40855f84 data-v-a9c8afb8><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-a9c8afb8 data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-a9c8afb8><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-a9c8afb8><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-1d30fa41 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav" data-v-b2cf3e0b data-v-f5a2ca58><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-f5a2ca58><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-f5a2ca58><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-f5a2ca58>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-f5a2ca58 data-v-079b16a8><button data-v-079b16a8>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-b2cf3e0b data-v-139a1f1d><div class="curtain" data-v-139a1f1d></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-139a1f1d><span class="visually-hidden" id="sidebar-aria-label" data-v-139a1f1d> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-139a1f1d><section class="VPSidebarItem level-0 has-active" data-v-139a1f1d data-v-c4656e6d><!----><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2简介</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/404" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>404错误分析</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/axios" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2 Axios</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/axioscode" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2 Axios Code</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/bind" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2双向绑定</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/communication" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2组件间通信</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/components_plugin" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2组件插件区别</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/cors" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2解决跨域</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/data_object_add_attrs" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2添加属性</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/data" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2 Data属性</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/diff" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2 Diff算法</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/directive" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2 指令</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/error" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2 Restful错误处理</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/filter" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2过滤器</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/first_page_time" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2首屏加载</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/if_for" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2 v-if v-for</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/keepalive" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2 keep-alive</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/key" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2 key原理</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/lifecycle" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2生命周期</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/mixin" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2 Mixin</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/modifier" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2修饰符</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/new_vue" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2实例挂载</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/nexttick" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2 NextTick</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/observable" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2 Observable</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/permission" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2权限管理</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/show_if" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2 v-show v-if</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/slot" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2插槽</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/spa" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>SPA单页面</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link is-active has-active" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/ssr" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>服务端渲染</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/structure" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2目录结构</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/vnode" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2虚拟DOM</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/vue2/vue3_vue2" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Vue2和Vue3区别</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-b2cf3e0b data-v-a494bd1d><div class="VPDoc has-sidebar has-aside" data-v-a494bd1d data-v-c4b0d3cf><!--[--><!--]--><div class="container" data-v-c4b0d3cf><div class="aside" data-v-c4b0d3cf><div class="aside-curtain" data-v-c4b0d3cf></div><div class="aside-container" data-v-c4b0d3cf><div class="aside-content" data-v-c4b0d3cf><div class="VPDocAside" data-v-c4b0d3cf data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-3f215769 data-v-ff0f39c8><div class="content" data-v-ff0f39c8><div class="outline-marker" data-v-ff0f39c8></div><div class="outline-title" data-v-ff0f39c8>本页目录</div><nav aria-labelledby="doc-outline-aria-label" data-v-ff0f39c8><span class="visually-hidden" id="doc-outline-aria-label" data-v-ff0f39c8> Table of Contents for current page </span><ul class="root" data-v-ff0f39c8 data-v-8f12e865><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-c4b0d3cf><div class="content-container" data-v-c4b0d3cf><!--[--><!--]--><!----><main class="main" data-v-c4b0d3cf><div style="position:relative;" class="vp-doc _docs_vue2_ssr" data-v-c4b0d3cf><div><h1 id="面试官-ssr解决了什么问题-有做过ssr吗-你是怎么做的" tabindex="-1">面试官：SSR解决了什么问题？有做过SSR吗？你是怎么做的？ <a class="header-anchor" href="#面试官-ssr解决了什么问题-有做过ssr吗-你是怎么做的">¶</a></h1><p><img src="https://static.vue-js.com/84bd83f0-4986-11eb-85f6-6fac77c0c9b3.png" alt=""></p><h2 id="一、是什么" tabindex="-1">一、是什么 <a class="header-anchor" href="#一、是什么">¶</a></h2><p><code>Server-Side Rendering</code> 我们称其为<code>SSR</code>，意为服务端渲染</p><p>指由服务侧完成页面的 <code>HTML</code> 结构拼接的页面处理技术，发送到浏览器，然后为其绑定状态与事件，成为完全可交互页面的过程</p><p>先来看看<code>Web</code>3个阶段的发展史：</p><ul><li>传统服务端渲染SSR</li><li>单页面应用SPA</li><li>服务端渲染SSR</li></ul><h3 id="传统web开发" tabindex="-1"><strong>传统web开发</strong> <a class="header-anchor" href="#传统web开发">¶</a></h3><p>网页内容在服务端渲染完成，⼀次性传输到浏览器</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e4d666b24e784fd09e565458c7753b54~tplv-k3u1fbpfcp-watermark.image" alt="img"></p><p>打开页面查看源码，浏览器拿到的是全部的<code>dom</code>结构</p><h3 id="单页应用spa" tabindex="-1"><strong>单页应用SPA</strong> <a class="header-anchor" href="#单页应用spa">¶</a></h3><p>单页应用优秀的用户体验，使其逐渐成为主流，页面内容由<code>JS</code>渲染出来，这种方式称为客户端渲染</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5e8e524a8e7d44cba73e0c3416690087~tplv-k3u1fbpfcp-watermark.image" alt="img"></p><p>打开页面查看源码，浏览器拿到的仅有宿主元素<code>#app</code>，并没有内容</p><h3 id="服务端渲染ssr" tabindex="-1">服务端渲染SSR <a class="header-anchor" href="#服务端渲染ssr">¶</a></h3><p><code>SSR</code>解决方案，后端渲染出完整的首屏的<code>dom</code>结构返回，前端拿到的内容包括首屏及完整<code>spa</code>结构，应用激活后依然按照<code>spa</code>方式运行</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f1604e7cfad7431f99920e8ab833bc37~tplv-k3u1fbpfcp-watermark.image" alt="img"></p><p>看完前端发展，我们再看看<code>Vue</code>官方对<code>SSR</code>的解释：</p><blockquote><p>Vue.js 是构建客户端应用程序的框架。默认情况下，可以在浏览器中输出 Vue 组件，进行生成 DOM 和操作 DOM。然而，也可以将同一个组件渲染为服务器端的 HTML 字符串，将它们直接发送到浏览器，最后将这些静态标记&quot;激活&quot;为客户端上完全可交互的应用程序</p><p>服务器渲染的 Vue.js 应用程序也可以被认为是&quot;同构&quot;或&quot;通用&quot;，因为应用程序的大部分代码都可以在服务器和客户端上运行</p></blockquote><p>我们从上门解释得到以下结论：</p><ul><li><code>Vue SSR</code>是一个在<code>SPA</code>上进行改良的服务端渲染</li><li>通过<code>Vue SSR</code>渲染的页面，需要在客户端激活才能实现交互</li><li><code>Vue SSR</code>将包含两部分：服务端渲染的首屏，包含交互的<code>SPA</code></li></ul><h2 id="二、解决了什么" tabindex="-1">二、解决了什么 <a class="header-anchor" href="#二、解决了什么">¶</a></h2><p>SSR主要解决了以下两种问题：</p><ul><li>seo：搜索引擎优先爬取页面<code>HTML</code>结构，使用<code>ssr</code>时，服务端已经生成了和业务想关联的<code>HTML</code>，有利于<code>seo</code></li><li>首屏呈现渲染：用户无需等待页面所有<code>js</code>加载完成就可以看到页面视图（压力来到了服务器，所以需要权衡哪些用服务端渲染，哪些交给客户端）</li></ul><p>但是使用<code>SSR</code>同样存在以下的缺点：</p><ul><li><p>复杂度：整个项目的复杂度</p></li><li><p>库的支持性，代码兼容</p></li><li><p>性能问题</p><ul><li><p>每个请求都是<code>n</code>个实例的创建，不然会污染，消耗会变得很大</p></li><li><p>缓存 <code>node serve </code>、 <code>nginx</code>判断当前用户有没有过期，如果没过期的话就缓存，用刚刚的结果。</p></li><li><p>降级：监控<code>cpu</code>、内存占用过多，就<code>spa</code>，返回单个的壳</p></li></ul></li><li><p>服务器负载变大，相对于前后端分离服务器只需要提供静态资源来说，服务器负载更大，所以要慎重使用</p></li></ul><p>所以在我们选择是否使用<code>SSR</code>前，我们需要慎重问问自己这些问题：</p><ol><li>需要<code>SEO</code>的页面是否只是少数几个，这些是否可以使用预渲染（Prerender SPA Plugin）实现</li><li>首屏的请求响应逻辑是否复杂，数据返回是否大量且缓慢</li></ol><h2 id="三、如何实现" tabindex="-1">三、如何实现 <a class="header-anchor" href="#三、如何实现">¶</a></h2><p>对于同构开发，我们依然使用<code>webpack</code>打包，我们要解决两个问题：服务端首屏渲染和客户端激活</p><p>这里需要生成一个服务器<code>bundle</code>文件用于服务端首屏渲染和一个客户端<code>bundle</code>文件用于客户端激活</p><p><img src="https://static.vue-js.com/9dcd12c0-4986-11eb-85f6-6fac77c0c9b3.png" alt=""></p><p>代码结构 除了两个不同入口之外，其他结构和之前<code>vue</code>应用完全相同</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">src</span></span>
<span class="line"><span style="color:#E1E4E8;">├── router</span></span>
<span class="line"><span style="color:#E1E4E8;">├────── index.js # 路由声明</span></span>
<span class="line"><span style="color:#E1E4E8;">├── store</span></span>
<span class="line"><span style="color:#E1E4E8;">├────── index.js # 全局状态</span></span>
<span class="line"><span style="color:#E1E4E8;">├── main.js # ⽤于创建vue实例</span></span>
<span class="line"><span style="color:#E1E4E8;">├── entry</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">client.js # 客户端⼊⼝，⽤于静态内容“激活”</span></span>
<span class="line"><span style="color:#E1E4E8;">└── entry</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">server.js # 服务端⼊⼝，⽤于⾸屏内容渲染</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">src</span></span>
<span class="line"><span style="color:#24292E;">├── router</span></span>
<span class="line"><span style="color:#24292E;">├────── index.js # 路由声明</span></span>
<span class="line"><span style="color:#24292E;">├── store</span></span>
<span class="line"><span style="color:#24292E;">├────── index.js # 全局状态</span></span>
<span class="line"><span style="color:#24292E;">├── main.js # ⽤于创建vue实例</span></span>
<span class="line"><span style="color:#24292E;">├── entry</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">client.js # 客户端⼊⼝，⽤于静态内容“激活”</span></span>
<span class="line"><span style="color:#24292E;">└── entry</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">server.js # 服务端⼊⼝，⽤于⾸屏内容渲染</span></span></code></pre></div><p>路由配置</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> Vue </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;vue&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> Router </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;vue-router&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">Vue.</span><span style="color:#B392F0;">use</span><span style="color:#E1E4E8;">(Router);</span></span>
<span class="line"><span style="color:#6A737D;">//导出⼯⼚函数</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createRouter</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Router</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">        mode: </span><span style="color:#9ECBFF;">&#39;history&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        routes: [</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 客户端没有编译器，这⾥要写成渲染函数</span></span>
<span class="line"><span style="color:#E1E4E8;">            { path: </span><span style="color:#9ECBFF;">&quot;/&quot;</span><span style="color:#E1E4E8;">, component: { </span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">: </span><span style="color:#FFAB70;">h</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">h</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;div&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;index page&#39;</span><span style="color:#E1E4E8;">) } },</span></span>
<span class="line"><span style="color:#E1E4E8;">            { path: </span><span style="color:#9ECBFF;">&quot;/detail&quot;</span><span style="color:#E1E4E8;">, component: { </span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">: </span><span style="color:#FFAB70;">h</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">h</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;div&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;detail page&#39;</span><span style="color:#E1E4E8;">) } }</span></span>
<span class="line"><span style="color:#E1E4E8;">        ]</span></span>
<span class="line"><span style="color:#E1E4E8;">    });</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> Vue </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;vue&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> Router </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;vue-router&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Vue.</span><span style="color:#6F42C1;">use</span><span style="color:#24292E;">(Router);</span></span>
<span class="line"><span style="color:#6A737D;">//导出⼯⼚函数</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createRouter</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Router</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">        mode: </span><span style="color:#032F62;">&#39;history&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        routes: [</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 客户端没有编译器，这⾥要写成渲染函数</span></span>
<span class="line"><span style="color:#24292E;">            { path: </span><span style="color:#032F62;">&quot;/&quot;</span><span style="color:#24292E;">, component: { </span><span style="color:#6F42C1;">render</span><span style="color:#24292E;">: </span><span style="color:#E36209;">h</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">h</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;div&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;index page&#39;</span><span style="color:#24292E;">) } },</span></span>
<span class="line"><span style="color:#24292E;">            { path: </span><span style="color:#032F62;">&quot;/detail&quot;</span><span style="color:#24292E;">, component: { </span><span style="color:#6F42C1;">render</span><span style="color:#24292E;">: </span><span style="color:#E36209;">h</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">h</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;div&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;detail page&#39;</span><span style="color:#24292E;">) } }</span></span>
<span class="line"><span style="color:#24292E;">        ]</span></span>
<span class="line"><span style="color:#24292E;">    });</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>主文件main.js</p><p>跟之前不同，主文件是负责创建<code>vue</code>实例的工厂，每次请求均会有独立的<code>vue</code>实例创建</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> Vue </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;vue&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> App </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;./App.vue&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { createRouter } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;./router&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#6A737D;">// 导出Vue实例⼯⼚函数，为每次请求创建独⽴实例</span></span>
<span class="line"><span style="color:#6A737D;">// 上下⽂⽤于给vue实例传递参数</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createApp</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">context</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">router</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createRouter</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">app</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Vue</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">        router,</span></span>
<span class="line"><span style="color:#E1E4E8;">        context,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">: </span><span style="color:#FFAB70;">h</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">h</span><span style="color:#E1E4E8;">(App)</span></span>
<span class="line"><span style="color:#E1E4E8;">    });</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> { app, router };</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> Vue </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;vue&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> App </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;./App.vue&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { createRouter } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;./router&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6A737D;">// 导出Vue实例⼯⼚函数，为每次请求创建独⽴实例</span></span>
<span class="line"><span style="color:#6A737D;">// 上下⽂⽤于给vue实例传递参数</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createApp</span><span style="color:#24292E;">(</span><span style="color:#E36209;">context</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">router</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createRouter</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">app</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Vue</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">        router,</span></span>
<span class="line"><span style="color:#24292E;">        context,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">render</span><span style="color:#24292E;">: </span><span style="color:#E36209;">h</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">h</span><span style="color:#24292E;">(App)</span></span>
<span class="line"><span style="color:#24292E;">    });</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> { app, router };</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>编写服务端入口<code>src/entry-server.js</code></p><p>它的任务是创建<code>Vue</code>实例并根据传入<code>url</code>指定首屏</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { createApp } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;./main&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#6A737D;">// 返回⼀个函数，接收请求上下⽂，返回创建的vue实例</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">context</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 这⾥返回⼀个Promise，确保路由或组件准备就绪</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Promise</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">resolve</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">reject</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">app</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">router</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createApp</span><span style="color:#E1E4E8;">(context);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 跳转到⾸屏的地址</span></span>
<span class="line"><span style="color:#E1E4E8;">        router.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(context.url);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 路由就绪，返回结果</span></span>
<span class="line"><span style="color:#E1E4E8;">        router.</span><span style="color:#B392F0;">onReady</span><span style="color:#E1E4E8;">(() </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(app);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }, reject);</span></span>
<span class="line"><span style="color:#E1E4E8;">    });</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { createApp } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;./main&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6A737D;">// 返回⼀个函数，接收请求上下⽂，返回创建的vue实例</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> </span><span style="color:#E36209;">context</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 这⾥返回⼀个Promise，确保路由或组件准备就绪</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Promise</span><span style="color:#24292E;">((</span><span style="color:#E36209;">resolve</span><span style="color:#24292E;">, </span><span style="color:#E36209;">reject</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">app</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">router</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createApp</span><span style="color:#24292E;">(context);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 跳转到⾸屏的地址</span></span>
<span class="line"><span style="color:#24292E;">        router.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(context.url);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 路由就绪，返回结果</span></span>
<span class="line"><span style="color:#24292E;">        router.</span><span style="color:#6F42C1;">onReady</span><span style="color:#24292E;">(() </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(app);</span></span>
<span class="line"><span style="color:#24292E;">        }, reject);</span></span>
<span class="line"><span style="color:#24292E;">    });</span></span>
<span class="line"><span style="color:#24292E;">};</span></span></code></pre></div><p>编写客户端入口<code>entry-client.js</code></p><p>客户端入口只需创建<code>vue</code>实例并执行挂载，这⼀步称为激活</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { createApp } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;./main&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#6A737D;">// 创建vue、router实例</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">app</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">router</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createApp</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#6A737D;">// 路由就绪，执⾏挂载</span></span>
<span class="line"><span style="color:#E1E4E8;">router.</span><span style="color:#B392F0;">onReady</span><span style="color:#E1E4E8;">(() </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    app.</span><span style="color:#B392F0;">$mount</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;#app&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { createApp } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;./main&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6A737D;">// 创建vue、router实例</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">app</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">router</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createApp</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#6A737D;">// 路由就绪，执⾏挂载</span></span>
<span class="line"><span style="color:#24292E;">router.</span><span style="color:#6F42C1;">onReady</span><span style="color:#24292E;">(() </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    app.</span><span style="color:#6F42C1;">$mount</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;#app&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><p>对<code>webpack</code>进行配置</p><p>安装依赖</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">npm install webpack</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">node</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">externals lodash.merge </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">D</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">npm install webpack</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">node</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">externals lodash.merge </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">D</span></span></code></pre></div><p>对<code>vue.config.js</code>进行配置</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 两个插件分别负责打包客户端和服务端</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">VueSSRServerPlugin</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;vue-server-renderer/server-plugin&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">VueSSRClientPlugin</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;vue-server-renderer/client-plugin&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">nodeExternals</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;webpack-node-externals&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">merge</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;lodash.merge&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#6A737D;">// 根据传⼊环境变量决定⼊⼝⽂件和相应配置项</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">TARGET_NODE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> p<wbr>rocess.env.</span><span style="color:#79B8FF;">WEBPACK_TARGET</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;node&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">target</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">TARGET_NODE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;server&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;client&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">module</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">exports</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    css: {</span></span>
<span class="line"><span style="color:#E1E4E8;">        extract: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">    outputDir: </span><span style="color:#9ECBFF;">&#39;./dist/&#39;</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">target,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">configureWebpack</span><span style="color:#E1E4E8;">: () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> ({</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 将 entry 指向应⽤程序的 server / client ⽂件</span></span>
<span class="line"><span style="color:#E1E4E8;">        entry: </span><span style="color:#9ECBFF;">`./src/entry-${</span><span style="color:#E1E4E8;">target</span><span style="color:#9ECBFF;">}.js`</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 对 bundle renderer 提供 source map ⽀持</span></span>
<span class="line"><span style="color:#E1E4E8;">        devtool: </span><span style="color:#9ECBFF;">&#39;source-map&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// target设置为node使webpack以Node适⽤的⽅式处理动态导⼊，</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 并且还会在编译Vue组件时告知`vue-loader`输出⾯向服务器代码。</span></span>
<span class="line"><span style="color:#E1E4E8;">        target: </span><span style="color:#79B8FF;">TARGET_NODE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;node&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;web&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 是否模拟node全局变量</span></span>
<span class="line"><span style="color:#E1E4E8;">        node: </span><span style="color:#79B8FF;">TARGET_NODE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">undefined</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        output: {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 此处使⽤Node⻛格导出模块</span></span>
<span class="line"><span style="color:#E1E4E8;">            libraryTarget: </span><span style="color:#79B8FF;">TARGET_NODE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;commonjs2&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">undefined</span></span>
<span class="line"><span style="color:#E1E4E8;">        },</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// https://webpack.js.org/configuration/externals/#function</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// https://github.com/liady/webpack-node-externals</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 外置化应⽤程序依赖模块。可以使服务器构建速度更快，并⽣成较⼩的打包⽂件。</span></span>
<span class="line"><span style="color:#E1E4E8;">        externals: </span><span style="color:#79B8FF;">TARGET_NODE</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">nodeExternals</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 不要外置化webpack需要处理的依赖模块。</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 可以在这⾥添加更多的⽂件类型。例如，未处理 *.vue 原始⽂件，</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 还应该将修改`global`（例如polyfill）的依赖模块列⼊⽩名单</span></span>
<span class="line"><span style="color:#E1E4E8;">            whitelist: [</span><span style="color:#9ECBFF;">/</span><span style="color:#85E89D;font-weight:bold;">\.</span><span style="color:#DBEDFF;">css</span><span style="color:#F97583;">$</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">        })</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">undefined</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        optimization: {</span></span>
<span class="line"><span style="color:#E1E4E8;">            splitChunks: </span><span style="color:#79B8FF;">undefined</span></span>
<span class="line"><span style="color:#E1E4E8;">        },</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 这是将服务器的整个输出构建为单个 JSON ⽂件的插件。</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 服务端默认⽂件名为 `vue-ssr-server-bundle.json`</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 客户端默认⽂件名为 `vue-ssr-client-manifest.json`。</span></span>
<span class="line"><span style="color:#E1E4E8;">        plugins: [</span><span style="color:#79B8FF;">TARGET_NODE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">VueSSRServerPlugin</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span></span>
<span class="line"><span style="color:#E1E4E8;">                  </span><span style="color:#B392F0;">VueSSRClientPlugin</span><span style="color:#E1E4E8;">()]</span></span>
<span class="line"><span style="color:#E1E4E8;">    }),</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">chainWebpack</span><span style="color:#E1E4E8;">: </span><span style="color:#FFAB70;">config</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// cli4项⽬添加</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">TARGET_NODE</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            config.optimization.</span><span style="color:#B392F0;">delete</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;splitChunks&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        config.module</span></span>
<span class="line"><span style="color:#E1E4E8;">            .</span><span style="color:#B392F0;">rule</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;vue&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">            .</span><span style="color:#B392F0;">use</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;vue-loader&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">            .</span><span style="color:#B392F0;">tap</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">options</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">merge</span><span style="color:#E1E4E8;">(options, {</span></span>
<span class="line"><span style="color:#E1E4E8;">                optimizeSSR: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">            });</span></span>
<span class="line"><span style="color:#E1E4E8;">        });</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 两个插件分别负责打包客户端和服务端</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">VueSSRServerPlugin</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;vue-server-renderer/server-plugin&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">VueSSRClientPlugin</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;vue-server-renderer/client-plugin&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">nodeExternals</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;webpack-node-externals&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">merge</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;lodash.merge&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#6A737D;">// 根据传⼊环境变量决定⼊⼝⽂件和相应配置项</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">TARGET_NODE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> p<wbr>rocess.env.</span><span style="color:#005CC5;">WEBPACK_TARGET</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;node&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">target</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">TARGET_NODE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">?</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;server&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;client&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#005CC5;">module</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">exports</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    css: {</span></span>
<span class="line"><span style="color:#24292E;">        extract: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">    outputDir: </span><span style="color:#032F62;">&#39;./dist/&#39;</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">target,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">configureWebpack</span><span style="color:#24292E;">: () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> ({</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 将 entry 指向应⽤程序的 server / client ⽂件</span></span>
<span class="line"><span style="color:#24292E;">        entry: </span><span style="color:#032F62;">`./src/entry-${</span><span style="color:#24292E;">target</span><span style="color:#032F62;">}.js`</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 对 bundle renderer 提供 source map ⽀持</span></span>
<span class="line"><span style="color:#24292E;">        devtool: </span><span style="color:#032F62;">&#39;source-map&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// target设置为node使webpack以Node适⽤的⽅式处理动态导⼊，</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 并且还会在编译Vue组件时告知`vue-loader`输出⾯向服务器代码。</span></span>
<span class="line"><span style="color:#24292E;">        target: </span><span style="color:#005CC5;">TARGET_NODE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">?</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;node&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;web&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 是否模拟node全局变量</span></span>
<span class="line"><span style="color:#24292E;">        node: </span><span style="color:#005CC5;">TARGET_NODE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">?</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">undefined</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        output: {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 此处使⽤Node⻛格导出模块</span></span>
<span class="line"><span style="color:#24292E;">            libraryTarget: </span><span style="color:#005CC5;">TARGET_NODE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">?</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;commonjs2&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">undefined</span></span>
<span class="line"><span style="color:#24292E;">        },</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// https://webpack.js.org/configuration/externals/#function</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// https://github.com/liady/webpack-node-externals</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 外置化应⽤程序依赖模块。可以使服务器构建速度更快，并⽣成较⼩的打包⽂件。</span></span>
<span class="line"><span style="color:#24292E;">        externals: </span><span style="color:#005CC5;">TARGET_NODE</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">?</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">nodeExternals</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 不要外置化webpack需要处理的依赖模块。</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 可以在这⾥添加更多的⽂件类型。例如，未处理 *.vue 原始⽂件，</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 还应该将修改`global`（例如polyfill）的依赖模块列⼊⽩名单</span></span>
<span class="line"><span style="color:#24292E;">            whitelist: [</span><span style="color:#032F62;">/</span><span style="color:#22863A;font-weight:bold;">\.</span><span style="color:#032F62;">css</span><span style="color:#D73A49;">$</span><span style="color:#032F62;">/</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">        })</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">undefined</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        optimization: {</span></span>
<span class="line"><span style="color:#24292E;">            splitChunks: </span><span style="color:#005CC5;">undefined</span></span>
<span class="line"><span style="color:#24292E;">        },</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 这是将服务器的整个输出构建为单个 JSON ⽂件的插件。</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 服务端默认⽂件名为 `vue-ssr-server-bundle.json`</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 客户端默认⽂件名为 `vue-ssr-client-manifest.json`。</span></span>
<span class="line"><span style="color:#24292E;">        plugins: [</span><span style="color:#005CC5;">TARGET_NODE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">?</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">VueSSRServerPlugin</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span></span>
<span class="line"><span style="color:#24292E;">                  </span><span style="color:#6F42C1;">VueSSRClientPlugin</span><span style="color:#24292E;">()]</span></span>
<span class="line"><span style="color:#24292E;">    }),</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">chainWebpack</span><span style="color:#24292E;">: </span><span style="color:#E36209;">config</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// cli4项⽬添加</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">TARGET_NODE</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            config.optimization.</span><span style="color:#6F42C1;">delete</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;splitChunks&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        config.module</span></span>
<span class="line"><span style="color:#24292E;">            .</span><span style="color:#6F42C1;">rule</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;vue&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">            .</span><span style="color:#6F42C1;">use</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;vue-loader&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">            .</span><span style="color:#6F42C1;">tap</span><span style="color:#24292E;">(</span><span style="color:#E36209;">options</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">merge</span><span style="color:#24292E;">(options, {</span></span>
<span class="line"><span style="color:#24292E;">                optimizeSSR: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">            });</span></span>
<span class="line"><span style="color:#24292E;">        });</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">};</span></span></code></pre></div><p>对脚本进行配置，安装依赖</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">npm i cross</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">env </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">D</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">npm i cross</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">env </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">D</span></span></code></pre></div><p>定义创建脚本<code>package.json</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#9ECBFF;">&quot;scripts&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;build:client&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;vue-cli-service build&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;build:server&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;cross-env WEBPACK_TARGET=node vue-cli-service build&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;build&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;npm run build:server &amp;&amp; npm run build:client&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#032F62;">&quot;scripts&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;build:client&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;vue-cli-service build&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;build:server&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;cross-env WEBPACK_TARGET=node vue-cli-service build&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;build&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;npm run build:server &amp;&amp; npm run build:client&quot;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><blockquote><p>执行打包：npm run build</p></blockquote><p>最后修改宿主文件<code>/public/index.html</code></p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;!</span><span style="color:#85E89D;">DOCTYPE</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">html</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">html</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">lang</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;en&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">head</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">meta</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">charset</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;utf-8&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">meta</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">http-equiv</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;X-UA-Compatible&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">content</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;IE=edge&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">meta</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">name</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;viewport&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">content</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;width=device-width,initial-scale=1.0&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">title</span><span style="color:#E1E4E8;">&gt;Document&lt;/</span><span style="color:#85E89D;">title</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">head</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">body</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">&lt;!--vue-ssr-outlet--&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">body</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">html</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;!</span><span style="color:#22863A;">DOCTYPE</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">html</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">html</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">lang</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;en&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">head</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">meta</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">charset</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;utf-8&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">meta</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">http-equiv</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;X-UA-Compatible&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">content</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;IE=edge&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">meta</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">name</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;viewport&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">content</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;width=device-width,initial-scale=1.0&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">title</span><span style="color:#24292E;">&gt;Document&lt;/</span><span style="color:#22863A;">title</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;/</span><span style="color:#22863A;">head</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">body</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">&lt;!--vue-ssr-outlet--&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;/</span><span style="color:#22863A;">body</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">html</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><blockquote> 是服务端渲染入口位置，注意不能为了好看而在前后加空格 </blockquote><p>安装<code>vuex</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">npm install </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">S</span><span style="color:#E1E4E8;"> vuex</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">npm install </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">S</span><span style="color:#24292E;"> vuex</span></span></code></pre></div><p>创建<code>vuex</code>工厂函数</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> Vue </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;vue&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> Vuex </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;vuex&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">Vue.</span><span style="color:#B392F0;">use</span><span style="color:#E1E4E8;">(Vuex)</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createStore</span><span style="color:#E1E4E8;"> () {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> Vuex.</span><span style="color:#B392F0;">Store</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">        state: {</span></span>
<span class="line"><span style="color:#E1E4E8;">            count:</span><span style="color:#79B8FF;">108</span></span>
<span class="line"><span style="color:#E1E4E8;">        },</span></span>
<span class="line"><span style="color:#E1E4E8;">        mutations: {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">add</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">state</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">                state.count </span><span style="color:#F97583;">+=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    })</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> Vue </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;vue&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> Vuex </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;vuex&#39;</span></span>
<span class="line"><span style="color:#24292E;">Vue.</span><span style="color:#6F42C1;">use</span><span style="color:#24292E;">(Vuex)</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createStore</span><span style="color:#24292E;"> () {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> Vuex.</span><span style="color:#6F42C1;">Store</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">        state: {</span></span>
<span class="line"><span style="color:#24292E;">            count:</span><span style="color:#005CC5;">108</span></span>
<span class="line"><span style="color:#24292E;">        },</span></span>
<span class="line"><span style="color:#24292E;">        mutations: {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">add</span><span style="color:#24292E;">(</span><span style="color:#E36209;">state</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">                state.count </span><span style="color:#D73A49;">+=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    })</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>在<code>main.js</code>文件中挂载<code>store</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { createStore } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;./store&#39;</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createApp</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">context</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 创建实例</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">store</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createStore</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">app</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Vue</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">        store, </span><span style="color:#6A737D;">// 挂载</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">: </span><span style="color:#FFAB70;">h</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">h</span><span style="color:#E1E4E8;">(App)</span></span>
<span class="line"><span style="color:#E1E4E8;">    })</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> { app, router, store }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { createStore } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;./store&#39;</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createApp</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">context</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 创建实例</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">store</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createStore</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">app</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Vue</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">        store, </span><span style="color:#6A737D;">// 挂载</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">render</span><span style="color:#24292E;">: </span><span style="color:#E36209;">h</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">h</span><span style="color:#24292E;">(App)</span></span>
<span class="line"><span style="color:#24292E;">    })</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> { app, router, store }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>服务器端渲染的是应用程序的&quot;快照&quot;，如果应用依赖于⼀些异步数据，那么在开始渲染之前，需要先预取和解析好这些数据</p><p>在<code>store</code>进行一步数据获取</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createStore</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> Vuex.</span><span style="color:#B392F0;">Store</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">        mutations: {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 加⼀个初始化</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">init</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">state</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">count</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                state.count </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> count;</span></span>
<span class="line"><span style="color:#E1E4E8;">            },</span></span>
<span class="line"><span style="color:#E1E4E8;">        },</span></span>
<span class="line"><span style="color:#E1E4E8;">        actions: {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 加⼀个异步请求count的action</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">getCount</span><span style="color:#E1E4E8;">({ </span><span style="color:#FFAB70;">commit</span><span style="color:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Promise</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">resolve</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#B392F0;">setTimeout</span><span style="color:#E1E4E8;">(() </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#B392F0;">commit</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;init&quot;</span><span style="color:#E1E4E8;">, Math.</span><span style="color:#B392F0;">random</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">100</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">                    }, </span><span style="color:#79B8FF;">1000</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">                });</span></span>
<span class="line"><span style="color:#E1E4E8;">            },</span></span>
<span class="line"><span style="color:#E1E4E8;">        },</span></span>
<span class="line"><span style="color:#E1E4E8;">    });</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createStore</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> Vuex.</span><span style="color:#6F42C1;">Store</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">        mutations: {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 加⼀个初始化</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">init</span><span style="color:#24292E;">(</span><span style="color:#E36209;">state</span><span style="color:#24292E;">, </span><span style="color:#E36209;">count</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                state.count </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> count;</span></span>
<span class="line"><span style="color:#24292E;">            },</span></span>
<span class="line"><span style="color:#24292E;">        },</span></span>
<span class="line"><span style="color:#24292E;">        actions: {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 加⼀个异步请求count的action</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">getCount</span><span style="color:#24292E;">({ </span><span style="color:#E36209;">commit</span><span style="color:#24292E;"> }) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Promise</span><span style="color:#24292E;">(</span><span style="color:#E36209;">resolve</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6F42C1;">setTimeout</span><span style="color:#24292E;">(() </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6F42C1;">commit</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;init&quot;</span><span style="color:#24292E;">, Math.</span><span style="color:#6F42C1;">random</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">100</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">                    }, </span><span style="color:#005CC5;">1000</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">                });</span></span>
<span class="line"><span style="color:#24292E;">            },</span></span>
<span class="line"><span style="color:#24292E;">        },</span></span>
<span class="line"><span style="color:#24292E;">    });</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>组件中的数据预取逻辑</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">asyncData</span><span style="color:#E1E4E8;">({ </span><span style="color:#FFAB70;">store</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">route</span><span style="color:#E1E4E8;"> }) { </span><span style="color:#6A737D;">// 约定预取逻辑编写在预取钩⼦asyncData中</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 触发 action 后，返回 Promise 以便确定请求结果</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> store.</span><span style="color:#B392F0;">dispatch</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;getCount&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">asyncData</span><span style="color:#24292E;">({ </span><span style="color:#E36209;">store</span><span style="color:#24292E;">, </span><span style="color:#E36209;">route</span><span style="color:#24292E;"> }) { </span><span style="color:#6A737D;">// 约定预取逻辑编写在预取钩⼦asyncData中</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 触发 action 后，返回 Promise 以便确定请求结果</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> store.</span><span style="color:#6F42C1;">dispatch</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;getCount&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">};</span></span></code></pre></div><p>服务端数据预取，<code>entry-server.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { createApp } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;./app&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">context</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Promise</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">resolve</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">reject</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 拿出store和router实例</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">app</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">router</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">store</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createApp</span><span style="color:#E1E4E8;">(context);</span></span>
<span class="line"><span style="color:#E1E4E8;">        router.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(context.url);</span></span>
<span class="line"><span style="color:#E1E4E8;">        router.</span><span style="color:#B392F0;">onReady</span><span style="color:#E1E4E8;">(() </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 获取匹配的路由组件数组</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">matchedComponents</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> router.</span><span style="color:#B392F0;">getMatchedComponents</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 若⽆匹配则抛出异常</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">matchedComponents.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">reject</span><span style="color:#E1E4E8;">({ code: </span><span style="color:#79B8FF;">404</span><span style="color:#E1E4E8;"> });</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 对所有匹配的路由组件调⽤可能存在的`asyncData()`</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">Promise</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">all</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">                matchedComponents.</span><span style="color:#B392F0;">map</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">Component</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (Component.asyncData) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> Component.</span><span style="color:#B392F0;">asyncData</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">                            store,</span></span>
<span class="line"><span style="color:#E1E4E8;">                            route: router.currentRoute,</span></span>
<span class="line"><span style="color:#E1E4E8;">                        });</span></span>
<span class="line"><span style="color:#E1E4E8;">                    }</span></span>
<span class="line"><span style="color:#E1E4E8;">                }),</span></span>
<span class="line"><span style="color:#E1E4E8;">            )</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">then</span><span style="color:#E1E4E8;">(() </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#6A737D;">// 所有预取钩⼦ resolve 后，</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#6A737D;">// store 已经填充⼊渲染应⽤所需状态</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#6A737D;">// 将状态附加到上下⽂，且 `template` 选项⽤于 renderer 时，</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#6A737D;">// 状态将⾃动序列化为 `window.__INITIAL_STATE__`，并注⼊ HTML</span></span>
<span class="line"><span style="color:#E1E4E8;">                context.state </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> store.state;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(app);</span></span>
<span class="line"><span style="color:#E1E4E8;">            })</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">catch</span><span style="color:#E1E4E8;">(reject);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }, reject);</span></span>
<span class="line"><span style="color:#E1E4E8;">    });</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { createApp } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;./app&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> </span><span style="color:#E36209;">context</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Promise</span><span style="color:#24292E;">((</span><span style="color:#E36209;">resolve</span><span style="color:#24292E;">, </span><span style="color:#E36209;">reject</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 拿出store和router实例</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">app</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">router</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">store</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createApp</span><span style="color:#24292E;">(context);</span></span>
<span class="line"><span style="color:#24292E;">        router.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(context.url);</span></span>
<span class="line"><span style="color:#24292E;">        router.</span><span style="color:#6F42C1;">onReady</span><span style="color:#24292E;">(() </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 获取匹配的路由组件数组</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">matchedComponents</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> router.</span><span style="color:#6F42C1;">getMatchedComponents</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 若⽆匹配则抛出异常</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">!</span><span style="color:#24292E;">matchedComponents.</span><span style="color:#005CC5;">length</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">reject</span><span style="color:#24292E;">({ code: </span><span style="color:#005CC5;">404</span><span style="color:#24292E;"> });</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 对所有匹配的路由组件调⽤可能存在的`asyncData()`</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#005CC5;">Promise</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">all</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">                matchedComponents.</span><span style="color:#6F42C1;">map</span><span style="color:#24292E;">(</span><span style="color:#E36209;">Component</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (Component.asyncData) {</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> Component.</span><span style="color:#6F42C1;">asyncData</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">                            store,</span></span>
<span class="line"><span style="color:#24292E;">                            route: router.currentRoute,</span></span>
<span class="line"><span style="color:#24292E;">                        });</span></span>
<span class="line"><span style="color:#24292E;">                    }</span></span>
<span class="line"><span style="color:#24292E;">                }),</span></span>
<span class="line"><span style="color:#24292E;">            )</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">then</span><span style="color:#24292E;">(() </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6A737D;">// 所有预取钩⼦ resolve 后，</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6A737D;">// store 已经填充⼊渲染应⽤所需状态</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6A737D;">// 将状态附加到上下⽂，且 `template` 选项⽤于 renderer 时，</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6A737D;">// 状态将⾃动序列化为 `window.__INITIAL_STATE__`，并注⼊ HTML</span></span>
<span class="line"><span style="color:#24292E;">                context.state </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> store.state;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(app);</span></span>
<span class="line"><span style="color:#24292E;">            })</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">catch</span><span style="color:#24292E;">(reject);</span></span>
<span class="line"><span style="color:#24292E;">        }, reject);</span></span>
<span class="line"><span style="color:#24292E;">    });</span></span>
<span class="line"><span style="color:#24292E;">};</span></span></code></pre></div><p>客户端在挂载到应用程序之前，<code>store</code> 就应该获取到状态，<code>entry-client.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 导出store</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">app</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">router</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">store</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createApp</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#6A737D;">// 当使⽤ template 时，context.state 将作为 window.__INITIAL_STATE__ 状态⾃动嵌⼊到最终的 HTML </span></span>
<span class="line"><span style="color:#6A737D;">// 在客户端挂载到应⽤程序之前，store 就应该获取到状态：</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (window.__INITIAL_STATE__) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    store.</span><span style="color:#B392F0;">replaceState</span><span style="color:#E1E4E8;">(window.__INITIAL_STATE__);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 导出store</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">app</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">router</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">store</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createApp</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#6A737D;">// 当使⽤ template 时，context.state 将作为 window.__INITIAL_STATE__ 状态⾃动嵌⼊到最终的 HTML </span></span>
<span class="line"><span style="color:#6A737D;">// 在客户端挂载到应⽤程序之前，store 就应该获取到状态：</span></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (window.__INITIAL_STATE__) {</span></span>
<span class="line"><span style="color:#24292E;">    store.</span><span style="color:#6F42C1;">replaceState</span><span style="color:#24292E;">(window.__INITIAL_STATE__);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>客户端数据预取处理，<code>main.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Vue.</span><span style="color:#B392F0;">mixin</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">beforeMount</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">asyncData</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.$options;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (asyncData) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 将获取数据操作分配给 promise</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 以便在组件中，我们可以在数据准备就绪后</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 通过运⾏ `this.dataPromise.then(...)` 来执⾏其他任务</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.dataPromise </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">asyncData</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">                store: </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.$store,</span></span>
<span class="line"><span style="color:#E1E4E8;">                route: </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.$route,</span></span>
<span class="line"><span style="color:#E1E4E8;">            });</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Vue.</span><span style="color:#6F42C1;">mixin</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">beforeMount</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">asyncData</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.$options;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (asyncData) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 将获取数据操作分配给 promise</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 以便在组件中，我们可以在数据准备就绪后</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 通过运⾏ `this.dataPromise.then(...)` 来执⾏其他任务</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.dataPromise </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">asyncData</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">                store: </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.$store,</span></span>
<span class="line"><span style="color:#24292E;">                route: </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.$route,</span></span>
<span class="line"><span style="color:#24292E;">            });</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><p>修改服务器启动文件</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 获取⽂件路径</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">dir</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;path&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(__dirname, dir)</span></span>
<span class="line"><span style="color:#6A737D;">// 第 1 步：开放dist/client⽬录，关闭默认下载index⻚的选项，不然到不了后⾯路由</span></span>
<span class="line"><span style="color:#E1E4E8;">app.</span><span style="color:#B392F0;">use</span><span style="color:#E1E4E8;">(express.</span><span style="color:#B392F0;">static</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;../dist/client&#39;</span><span style="color:#E1E4E8;">), {index: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">}))</span></span>
<span class="line"><span style="color:#6A737D;">// 第 2 步：获得⼀个createBundleRenderer</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">createBundleRenderer</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;vue-server-renderer&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#6A737D;">// 第 3 步：服务端打包⽂件地址</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">bundle</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;../dist/server/vue-ssr-server-bundle.json&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#6A737D;">// 第 4 步：创建渲染器</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">renderer</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createBundleRenderer</span><span style="color:#E1E4E8;">(bundle, {</span></span>
<span class="line"><span style="color:#E1E4E8;">    runInNewContext: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">// https://ssr.vuejs.org/zh/api/#runinnewcontext</span></span>
<span class="line"><span style="color:#E1E4E8;">    template: </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;fs&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">readFileSync</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;../public/index.html&quot;</span><span style="color:#E1E4E8;">), </span><span style="color:#9ECBFF;">&quot;utf8&quot;</span><span style="color:#E1E4E8;">), </span><span style="color:#6A737D;">// 宿主⽂件</span></span>
<span class="line"><span style="color:#E1E4E8;">    clientManifest: </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;../dist/client/vue-ssr-clientmanifest.json&quot;</span><span style="color:#E1E4E8;">)) </span><span style="color:#6A737D;">// 客户端清单</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"><span style="color:#E1E4E8;">app.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;*&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">req</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">res</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 设置url和title两个重要参数</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">context</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        title:</span><span style="color:#9ECBFF;">&#39;ssr test&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        url:req.url</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">html</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> renderer.</span><span style="color:#B392F0;">renderToString</span><span style="color:#E1E4E8;">(context);</span></span>
<span class="line"><span style="color:#E1E4E8;">    res.</span><span style="color:#B392F0;">send</span><span style="color:#E1E4E8;">(html)</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 获取⽂件路径</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#E36209;">dir</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;path&#39;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(__dirname, dir)</span></span>
<span class="line"><span style="color:#6A737D;">// 第 1 步：开放dist/client⽬录，关闭默认下载index⻚的选项，不然到不了后⾯路由</span></span>
<span class="line"><span style="color:#24292E;">app.</span><span style="color:#6F42C1;">use</span><span style="color:#24292E;">(express.</span><span style="color:#6F42C1;">static</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;../dist/client&#39;</span><span style="color:#24292E;">), {index: </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">}))</span></span>
<span class="line"><span style="color:#6A737D;">// 第 2 步：获得⼀个createBundleRenderer</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">createBundleRenderer</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;vue-server-renderer&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#6A737D;">// 第 3 步：服务端打包⽂件地址</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">bundle</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;../dist/server/vue-ssr-server-bundle.json&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#6A737D;">// 第 4 步：创建渲染器</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">renderer</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createBundleRenderer</span><span style="color:#24292E;">(bundle, {</span></span>
<span class="line"><span style="color:#24292E;">    runInNewContext: </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">// https://ssr.vuejs.org/zh/api/#runinnewcontext</span></span>
<span class="line"><span style="color:#24292E;">    template: </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;fs&#39;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">readFileSync</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;../public/index.html&quot;</span><span style="color:#24292E;">), </span><span style="color:#032F62;">&quot;utf8&quot;</span><span style="color:#24292E;">), </span><span style="color:#6A737D;">// 宿主⽂件</span></span>
<span class="line"><span style="color:#24292E;">    clientManifest: </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;../dist/client/vue-ssr-clientmanifest.json&quot;</span><span style="color:#24292E;">)) </span><span style="color:#6A737D;">// 客户端清单</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"><span style="color:#24292E;">app.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;*&#39;</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">async</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">req</span><span style="color:#24292E;">,</span><span style="color:#E36209;">res</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 设置url和title两个重要参数</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">context</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        title:</span><span style="color:#032F62;">&#39;ssr test&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        url:req.url</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">html</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> renderer.</span><span style="color:#6F42C1;">renderToString</span><span style="color:#24292E;">(context);</span></span>
<span class="line"><span style="color:#24292E;">    res.</span><span style="color:#6F42C1;">send</span><span style="color:#24292E;">(html)</span></span>
<span class="line"><span style="color:#24292E;">})</span></span></code></pre></div><h3 id="小结" tabindex="-1">小结 <a class="header-anchor" href="#小结">¶</a></h3><ul><li>使用<code>ssr</code>不存在单例模式，每次用户请求都会创建一个新的<code>vue</code>实例</li><li>实现<code>ssr</code>需要实现服务端首屏渲染和客户端激活</li><li>服务端异步获取数据<code>asyncData</code>可以分为首屏异步获取和切换组件获取 <ul><li>首屏异步获取数据，在服务端预渲染的时候就应该已经完成</li><li>切换组件通过<code>mixin</code>混入，在<code>beforeMount</code>钩子完成数据获取</li></ul></li></ul><h2 id="参考文献" tabindex="-1">参考文献 <a class="header-anchor" href="#参考文献">¶</a></h2><ul><li><a href="https://juejin.cn/post/6896007907050487816" target="_blank" rel="noreferrer">https://juejin.cn/post/6896007907050487816</a></li><li><a href="https://vue3js.cn/docs/zh" target="_blank" rel="noreferrer">https://vue3js.cn/docs/zh</a></li></ul></div></div></main><footer class="VPDocFooter" data-v-c4b0d3cf data-v-face870a><!--[--><!--]--><div class="edit-info" data-v-face870a><!----><div class="last-updated" data-v-face870a><p class="VPLastUpdated" data-v-face870a data-v-7b3ebfe1>上次更新: <time datetime="2023-04-05T14:44:42.000Z" data-v-7b3ebfe1></time></p></div></div><div class="prev-next" data-v-face870a><div class="pager" data-v-face870a><a class="pager-link prev" href="/docs/vue2/spa" data-v-face870a><span class="desc" data-v-face870a>Previous page</span><span class="title" data-v-face870a>SPA单页面</span></a></div><div class="has-prev pager" data-v-face870a><a class="pager-link next" href="/docs/vue2/structure" data-v-face870a><span class="desc" data-v-face870a>Next page</span><span class="title" data-v-face870a>Vue2目录结构</span></a></div></div></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-b2cf3e0b data-v-2f86ebd2><div class="container" data-v-2f86ebd2><p class="message" data-v-2f86ebd2>Released under the MIT License.</p><p class="copyright" data-v-2f86ebd2>Copyright © 2023-present ZOE</p></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"css_css_performance.md\":\"9662ceb0\",\"css_em_px_rem_vh_vw.md\":\"7ccd2003\",\"applet_publish.md\":\"17cf6dd6\",\"algorithm_linked_list.md\":\"de4342eb\",\"algorithm_stack_queue.md\":\"a2f49fd9\",\"applet_index.md\":\"d51e3937\",\"algorithm_bubble_sort.md\":\"03445559\",\"css_index.md\":\"5d93cdd0\",\"git_index.md\":\"6584fe2e\",\"algorithm_graph.md\":\"00d4f498\",\"design_factory.md\":\"fb6a2a88\",\"es6_var_let_const.md\":\"30bd2585\",\"algorithm_insertion_sort.md\":\"425cf725\",\"css_animation.md\":\"2ae3a5f4\",\"css_less_12px.md\":\"b64e4d7f\",\"algorithm_design2.md\":\"1f103d06\",\"css_column_layout.md\":\"b38f7106\",\"algorithm_design1.md\":\"7da96ff4\",\"css_center.md\":\"be102fb0\",\"algorithm_binary_search.md\":\"8851b051\",\"applet_optimization.md\":\"a67124c0\",\"css_responsive_layout.md\":\"c3287e0f\",\"css_dp_px_dpr_ppi.md\":\"568ae4e6\",\"design_observer.md\":\"34f832e5\",\"css_grid_layout.md\":\"0faddebc\",\"javascript_index.md\":\"a8179dc3\",\"javascript_scope.md\":\"eeaf9f07\",\"css_layout_painting.md\":\"2ea072db\",\"nodejs_paging.md\":\"bf6a7174\",\"git_pull_fetch.md\":\"32726ded\",\"linux_redirect_pipe.md\":\"4497518e\",\"nodejs_middleware.md\":\"b1c48e89\",\"vue2_error.md\":\"ada2eb48\",\"git_command.md\":\"711c08d8\",\"git_reset_revert.md\":\"811eac7c\",\"react_summary.md\":\"9155f99b\",\"vue2_first_page_time.md\":\"903ebdc8\",\"algorithm_set.md\":\"1c4bb744\",\"javascript_closure.md\":\"ab44efa5\",\"git_stash.md\":\"29d60db8\",\"es6_index.md\":\"7f1e27c8\",\"css_visual_scrolling.md\":\"31cddf7f\",\"es6_generator.md\":\"d9971c24\",\"http_dns.md\":\"642bb39f\",\"git_rebase_merge.md\":\"6b43f9a4\",\"algorithm_quick_sort.md\":\"ac789427\",\"vue2_modifier.md\":\"7dec2e90\",\"react_immutable.md\":\"b3cfc8ca\",\"git_git.md\":\"1a836f0a\",\"algorithm_time_space.md\":\"15299952\",\"react_improve_render.md\":\"5b4739fc\",\"vue2_filter.md\":\"94bd6cb0\",\"http_headers.md\":\"01e82eb5\",\"react_index.md\":\"c76d38f3\",\"react_class_function_component.md\":\"5fc19938\",\"react_import_css.md\":\"41aa8b14\",\"http_handshakes_waves.md\":\"454c7237\",\"es6_function.md\":\"7217c389\",\"es6_proxy.md\":\"b8476595\",\"vue2_data_object_add_attrs.md\":\"5a2b1baf\",\"linux_index.md\":\"a34d4a6c\",\"design_singleton.md\":\"78f5ce02\",\"http_http_https.md\":\"74125135\",\"http_udp_tcp.md\":\"1a78369f\",\"react_react_refs.md\":\"575b07a8\",\"design_strategy.md\":\"0b0b465f\",\"http_tcp_ip.md\":\"e29e0d58\",\"http_websocket.md\":\"b06caed8\",\"http_osi.md\":\"299b3943\",\"nodejs_performance.md\":\"ba487425\",\"javascript_data_type.md\":\"7d785405\",\"javascript_regexp.md\":\"913d2457\",\"design_proxy.md\":\"718b7e7c\",\"react_high_order_components.md\":\"762df258\",\"nodejs_file_upload.md\":\"12be1879\",\"nodejs_require_order.md\":\"e4ae28be\",\"nodejs_process.md\":\"5b0788ba\",\"javascript_security.md\":\"21c501fe\",\"http_after_url.md\":\"4f9cde19\",\"nodejs_stream.md\":\"14bfc20f\",\"applet_lifecycle.md\":\"b88e16e8\",\"javascript_debounce_throttle.md\":\"4b28180f\",\"nodejs_global.md\":\"f272d876\",\"javascript_function_cache.md\":\"dc470752\",\"react_jsx_to_dom.md\":\"5765d68b\",\"http_cdn.md\":\"324713f0\",\"vue2_components_plugin.md\":\"95e94c6a\",\"css_sass_less_stylus.md\":\"9f7c60ed\",\"css_box.md\":\"10505739\",\"linux_thread_process.md\":\"87515fac\",\"vue2_cors.md\":\"04231e81\",\"algorithm_selection_sort.md\":\"f10fd375\",\"git_head_tree_index.md\":\"ff39642d\",\"css_hide_attributes.md\":\"741d5025\",\"vue2_data.md\":\"4dc5c73b\",\"css_single_multi_line.md\":\"843f01eb\",\"react_communication.md\":\"121c4e40\",\"css_triangle.md\":\"0461e21c\",\"es6_object.md\":\"cf554545\",\"react_fiber.md\":\"0051e922\",\"react_super_ne_super_props.md\":\"ea3505d4\",\"css_selector.md\":\"393ede26\",\"git_fork_clone_branch.md\":\"574e72ab\",\"vue2_diff.md\":\"dfdede04\",\"algorithm_sort.md\":\"2ea257a8\",\"design_index.md\":\"fffc2f89\",\"algorithm_index.md\":\"a63468a5\",\"algorithm_tree.md\":\"181e1e1e\",\"react_synthetic_event.md\":\"e0f175b9\",\"nodejs_fs.md\":\"429e8d63\",\"typescript_typescript_javascript.md\":\"c81a6640\",\"git_conflict.md\":\"8cc7df5c\",\"vue2_if_for.md\":\"61b8e7c3\",\"typescript_interface.md\":\"fe8c2a24\",\"javascript_context_stack.md\":\"4e49666c\",\"applet_webview_jscore.md\":\"8edc43ca\",\"http_https.md\":\"5664aabe\",\"javascript_cache.md\":\"c2164a22\",\"typescript_namespace_module.md\":\"7f51aa5f\",\"javascript_new.md\":\"4b137164\",\"javascript_ajax.md\":\"4e8c6e30\",\"typescript_vue.md\":\"5cc468b7\",\"react_redux.md\":\"c6f8e1e7\",\"nodejs_index.md\":\"21ced3e6\",\"applet_request_payment.md\":\"15ee2d01\",\"react_redux_middleware.md\":\"be42a273\",\"vue2_axios.md\":\"a96aacb6\",\"react_controlled_uncontrolled.md\":\"a2c6c43d\",\"javascript_prototype.md\":\"2f9d3bdb\",\"applet_navigate.md\":\"d907a3da\",\"javascript_memory_leak.md\":\"67944cec\",\"javascript_functional_programming.md\":\"2a21e848\",\"typescript_generic.md\":\"c3e62b1c\",\"javascript_string_api.md\":\"907749c7\",\"http_index.md\":\"01891514\",\"typescript_decorator.md\":\"397a1e7e\",\"http_status.md\":\"9c602895\",\"typescript_function.md\":\"56f92719\",\"nodejs_event_loop.md\":\"f621a050\",\"nodejs_buffer.md\":\"1c5da97d\",\"typescript_high_type.md\":\"8e7cf919\",\"nodejs_event_emitter.md\":\"060e3275\",\"algorithm_structure.md\":\"09e63dd8\",\"javascript_pull_up_loading_pull_down_refresh.md\":\"7a528bcd\",\"linux_file.md\":\"3625b5a6\",\"react_render.md\":\"7a55d45e\",\"javascript_bind_call_apply.md\":\"52b0f151\",\"javascript_single_sign.md\":\"38b7aa8e\",\"vue2_404.md\":\"79660b55\",\"react_key.md\":\"d0250959\",\"react_server_side_rendering.md\":\"09686da5\",\"javascript_inherit.md\":\"e9a08871\",\"vue2_communication.md\":\"f8e8cd75\",\"javascript_typeof_instanceof.md\":\"083cdded\",\"webpack_improve_build.md\":\"914afca6\",\"react_set_state.md\":\"d3e469de\",\"webpack_index.md\":\"d1f151da\",\"javascript_event_agent.md\":\"7a7987f4\",\"vue3_goal.md\":\"237b0ea4\",\"react_binding_events.md\":\"a227c78e\",\"react_improve_performance.md\":\"962eeaa1\",\"vue2_bind.md\":\"0e810106\",\"es6_promise.md\":\"c6f2cefe\",\"algorithm_merge_sort.md\":\"d4145d6d\",\"vue2_axioscode.md\":\"26934e2c\",\"vue2_key.md\":\"43a3e217\",\"react_react_router_model.md\":\"93b4b6da\",\"javascript_loss_accuracy.md\":\"41136344\",\"vue2_observable.md\":\"cc7f2565\",\"react_diff.md\":\"84e2ae38\",\"react_how_to_use_redux.md\":\"ac9abc7e\",\"vue2_lifecycle.md\":\"18e58921\",\"vue2_index.md\":\"498cf5d3\",\"javascript_js_data_structure.md\":\"73025a11\",\"react_react_router.md\":\"ce2be52e\",\"vue2_directive.md\":\"fbf2cc51\",\"linux_shell.md\":\"01b99c64\",\"react_react_hooks.md\":\"e86c7585\",\"javascript_dom.md\":\"36082d19\",\"algorithm_heap.md\":\"e6339bf6\",\"index.md\":\"7217a3ab\",\"vue2_keepalive.md\":\"d7c01555\",\"css_css3_features.md\":\"2b923122\",\"linux_vim.md\":\"d6d910c3\",\"typescript_index.md\":\"9041cfec\",\"applet_login.md\":\"164da01d\",\"vue2_new_vue.md\":\"f6824110\",\"react_life_cycle.md\":\"676b5ac2\",\"typescript_enum.md\":\"3b16d025\",\"linux_users.md\":\"3a74afb9\",\"typescript_class.md\":\"771f3085\",\"vue2_mixin.md\":\"81076a72\",\"es6_set_map.md\":\"1ff0cd7d\",\"vue2_spa.md\":\"647bd451\",\"vue3_proxy.md\":\"bf57d216\",\"react_building_components.md\":\"d9f4a080\",\"javascript_copy.md\":\"e113e141\",\"vue2_structure.md\":\"b6e1829f\",\"webpack_proxy.md\":\"610a33e2\",\"vue2_vnode.md\":\"7ec6bb08\",\"javascript_tail_recursion.md\":\"28d70791\",\"vue2_vue3_vue2.md\":\"f4006b09\",\"vue2_permission.md\":\"7bdd8a1e\",\"webpack_compare_build_tools.md\":\"4ab3134e\",\"javascript_bom.md\":\"87a84254\",\"vue3_treeshaking.md\":\"2db9176c\",\"css_flexbox_layout.md\":\"da8e28a9\",\"typescript_react.md\":\"c163a728\",\"vue3_modal_component.md\":\"5f7976e3\",\"vue2_show_if.md\":\"9aa38377\",\"vue3_performance.md\":\"290806a3\",\"nodejs_jwt.md\":\"c6c3377c\",\"javascript_array_api.md\":\"86a41666\",\"webpack_plugin.md\":\"446ee64c\",\"vue3_index.md\":\"cbfa5de0\",\"webpack_hmr.md\":\"cc0e71ac\",\"webpack_loader_plugin.md\":\"c5c6b7c8\",\"react_state_props.md\":\"c03b918f\",\"react_capture_error.md\":\"9aae6160\",\"javascript_event_model.md\":\"96934894\",\"es6_decorator.md\":\"81ea788c\",\"vue2_nexttick.md\":\"9bb40fc2\",\"webpack_loader.md\":\"c170d19f\",\"javascript_event_loop.md\":\"488f95c1\",\"es6_array.md\":\"bf7dc887\",\"javascript_type_conversion.md\":\"1e7b7804\",\"vue2_ssr.md\":\"1045d2cb\",\"react_animation.md\":\"9c7bfe4e\",\"webpack_build_process.md\":\"5cccda3d\",\"http_get_post.md\":\"a001d288\",\"javascript_continue_to_upload.md\":\"085a4756\",\"javascript_this.md\":\"e00cced7\",\"javascript_visible.md\":\"a139442c\",\"vue2_slot.md\":\"9d0d6a8e\",\"webpack_performance.md\":\"fc58e903\"}")
__VP_SITE_DATA__ = JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"我的前端资料库\",\"description\":\"方便查看整理的前端资料，让工作和学习变得更轻松。\",\"base\":\"/docs/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"outlineTitle\":\"本页目录\",\"lastUpdatedText\":\"上次更新\",\"logo\":\"/logo.svg\",\"nav\":[{\"text\":\"前端\",\"items\":[{\"text\":\"CSS\",\"link\":\"/css/\",\"activeMatch\":\"^/css/\"},{\"text\":\"ES6\",\"link\":\"/es6/\",\"activeMatch\":\"^/es6/\"},{\"text\":\"JavaScript\",\"link\":\"/javascript/\",\"activeMatch\":\"^/javascript/\"},{\"text\":\"TypeScript\",\"link\":\"/typescript/\",\"activeMatch\":\"^/typescript/\"},{\"text\":\"Vue2\",\"link\":\"/vue2/\",\"activeMatch\":\"^/vue2/\"},{\"text\":\"Vue3\",\"link\":\"/vue3/\",\"activeMatch\":\"^/vue3/\"},{\"text\":\"React\",\"link\":\"/react/\",\"activeMatch\":\"^/react/\"},{\"text\":\"Webpack\",\"link\":\"/webpack/\",\"activeMatch\":\"^/webpack/\"},{\"text\":\"NodeJS\",\"link\":\"/nodejs/\",\"activeMatch\":\"^/nodejs/\"}]},{\"text\":\"算法\",\"link\":\"/algorithm/\",\"activeMatch\":\"^/algorithm/\"},{\"text\":\"设计\",\"link\":\"/design/\",\"activeMatch\":\"^/design/\"},{\"text\":\"Git\",\"link\":\"/git/\",\"activeMatch\":\"^/git/\"},{\"text\":\"Linux\",\"link\":\"/linux/\",\"activeMatch\":\"^/linux/\"},{\"text\":\"小程序\",\"link\":\"/applet/\",\"activeMatch\":\"^/applet/\"}],\"sidebar\":{\"/linux/\":[{\"text\":\"Linux\",\"link\":\"/linux/\"},{\"text\":\"Linux文件操作\",\"link\":\"/linux/file\"},{\"text\":\"Linux用户操作\",\"link\":\"/linux/users\"},{\"text\":\"Linux中Vim的使用\",\"link\":\"/linux/vim\"},{\"text\":\"Linux中Shell编程\",\"link\":\"/linux/shell\"},{\"text\":\"Linux中线程和进程\",\"link\":\"/linux/thread_process\"},{\"text\":\"Linux中重定向和管道\",\"link\":\"/linux/redirect_pipe\"}],\"/design/\":[{\"text\":\"设计模式\",\"link\":\"/design/\"},{\"text\":\"工厂模式\",\"link\":\"/design/factory\"},{\"text\":\"观察者模式\",\"link\":\"/design/observer\"},{\"text\":\"代理模式\",\"link\":\"/design/proxy\"},{\"text\":\"单例模式\",\"link\":\"/design/singleton\"},{\"text\":\"策略模式\",\"link\":\"/design/strategy\"}],\"/algorithm/\":[{\"text\":\"算法与数据结构\",\"link\":\"/algorithm/\"},{\"text\":\"数据结构\",\"link\":\"/algorithm/structure\"},{\"text\":\"栈和队列\",\"link\":\"/algorithm/stack_queue\"},{\"text\":\"链表结构\",\"link\":\"/algorithm/linked_list\"},{\"text\":\"集合结构\",\"link\":\"/algorithm/set\"},{\"text\":\"堆结构\",\"link\":\"/algorithm/heap\"},{\"text\":\"树结构\",\"link\":\"/algorithm/tree\"},{\"text\":\"图结构\",\"link\":\"/algorithm/graph\"},{\"text\":\"排序方法\",\"link\":\"/algorithm/sort\"},{\"text\":\"冒泡排序\",\"link\":\"/algorithm/bubble_sort\"},{\"text\":\"插入排序\",\"link\":\"/algorithm/insertion_sort\"},{\"text\":\"归并排序\",\"link\":\"/algorithm/merge_sort\"},{\"text\":\"选择排序\",\"link\":\"/algorithm/selection_sort\"},{\"text\":\"快速排序\",\"link\":\"/algorithm/quick_sort\"},{\"text\":\"分治法\",\"link\":\"/algorithm/design1\"},{\"text\":\"贪心回溯\",\"link\":\"/algorithm/design2\"},{\"text\":\"二分查找\",\"link\":\"/algorithm/binary_search\"},{\"text\":\"时间复杂度\",\"link\":\"/algorithm/time_space\"}],\"/applet/\":[{\"text\":\"小程序\",\"link\":\"/applet/\"},{\"text\":\"小程序原理\",\"link\":\"/applet/webview_jscore\"},{\"text\":\"生命周期\",\"link\":\"/applet/lifecycle\"},{\"text\":\"小程序登录\",\"link\":\"/applet/login\"},{\"text\":\"小程序路由\",\"link\":\"/applet/navigate\"},{\"text\":\"小程序性能\",\"link\":\"/applet/optimization\"},{\"text\":\"小程序支付\",\"link\":\"/applet/request_payment\"},{\"text\":\"小程序发布\",\"link\":\"/applet/publish\"}],\"/css/\":[{\"text\":\"CSS BFC\",\"link\":\"/css/\"},{\"text\":\"CSS动画\",\"link\":\"/css/animation\"},{\"text\":\"CSS盒子模型\",\"link\":\"/css/box\"},{\"text\":\"CSS元素居中\",\"link\":\"/css/center\"},{\"text\":\"CSS栅栏布局\",\"link\":\"/css/column_layout\"},{\"text\":\"CSS性能优化\",\"link\":\"/css/css_performance\"},{\"text\":\"DP，PX，DPR，PPI区别\",\"link\":\"/css/dp_px_dpr_ppi\"},{\"text\":\"EM，PX，REM，VH，VW区别\",\"link\":\"/css/em_px_rem_vh_vw\"},{\"text\":\"弹性盒布局\",\"link\":\"/css/flexbox_layout\"},{\"text\":\"网格布局\",\"link\":\"/css/grid_layout\"},{\"text\":\"隐藏元素\",\"link\":\"/css/hide_attributes\"},{\"text\":\"回流重绘\",\"link\":\"/css/layout_painting\"},{\"text\":\"小于12PX\",\"link\":\"/css/less_12px\"},{\"text\":\"响应式网站设计\",\"link\":\"/css/responsive_layout\"},{\"text\":\"CSS预编语言\",\"link\":\"/css/sass_less_stylus\"},{\"text\":\"CSS选择器\",\"link\":\"/css/selector\"},{\"text\":\"单行／多行处理\",\"link\":\"/css/single_multi_line\"},{\"text\":\"绘制三角形\",\"link\":\"/css/triangle\"},{\"text\":\"CSS视差滚动效果\",\"link\":\"/css/visual_scrolling\"}],\"/es6/\":[{\"text\":\"ES6模块化\",\"link\":\"/es6/\"},{\"text\":\"ES6集合扩展\",\"link\":\"/es6/array\"},{\"text\":\"ES6装饰器\",\"link\":\"/es6/decorator\"},{\"text\":\"ES6函数扩展\",\"link\":\"/es6/function\"},{\"text\":\"ES6 Generator\",\"link\":\"/es6/generator\"},{\"text\":\"ES6对象扩展\",\"link\":\"/es6/object\"},{\"text\":\"ES6 Promise\",\"link\":\"/es6/promise\"},{\"text\":\"ES6 Proxy\",\"link\":\"/es6/proxy\"},{\"text\":\"ES6 Set、Map\",\"link\":\"/es6/set_map\"},{\"text\":\"ES6 var、let、const\",\"link\":\"/es6/var_let_const\"}],\"/git/\":[{\"text\":\"版本管理简介\",\"link\":\"/git/\"},{\"text\":\"Git简介\",\"link\":\"/git/git\"},{\"text\":\"Git命令\",\"link\":\"/git/command\"},{\"text\":\"Git冲突处理\",\"link\":\"/git/conflict\"},{\"text\":\"Git Fork，Clone，Branch\",\"link\":\"/git/fork_clone_branch\"},{\"text\":\"Git工作树和索引\",\"link\":\"/git/head_tree_index\"},{\"text\":\"Git Pull，Fetch\",\"link\":\"/git/pull_fetch\"},{\"text\":\"Git Rebase，Merge\",\"link\":\"/git/rebase_merge\"},{\"text\":\"Git Reset,Revert\",\"link\":\"/git/reset_revert\"},{\"text\":\"Git Stash\",\"link\":\"/git/stash\"}],\"/http/\":[{\"text\":\"HTTP协议版本\",\"link\":\"/http/\"},{\"text\":\"浏览器URL解析\",\"link\":\"/http/after_url\"},{\"text\":\"CDN简介\",\"link\":\"/http/CDN\"},{\"text\":\"DNS简介\",\"link\":\"/http/DNS\"},{\"text\":\"GET和POST区别\",\"link\":\"/http/GET_POST\"},{\"text\":\"TCP三次握手\",\"link\":\"/http/handshakes_waves\"},{\"text\":\"HTTP请求头\",\"link\":\"/http/headers\"},{\"text\":\"HTTP和HTTPS区别\",\"link\":\"/http/HTTP_HTTPS\"},{\"text\":\"HTTP和HTTPS区别\",\"link\":\"/http/HTTP_HTTPS\"},{\"text\":\"HTTPS\",\"link\":\"/http/HTTPS\"},{\"text\":\"OSI七层\",\"link\":\"/http/OSI\"},{\"text\":\"HTTP状态码\",\"link\":\"/http/status\"},{\"text\":\"TCP/IP协议\",\"link\":\"/http/TCP_IP\"},{\"text\":\"UDP和TCP区别\",\"link\":\"/http/UDP_TCP\"},{\"text\":\"WebSocket\",\"link\":\"/http/WebSocket\"}],\"/javascript/\":[{\"text\":\"两等和三等区别\",\"link\":\"/javascript/\"},{\"text\":\"AJAX原理\",\"link\":\"/javascript/ajax\"},{\"text\":\"集合API\",\"link\":\"/javascript/array_api\"},{\"text\":\"Bind，Call，Apply区别\",\"link\":\"/javascript/bind_call_apply\"},{\"text\":\"BOM简介\",\"link\":\"/javascript/BOM\"},{\"text\":\"JS缓存\",\"link\":\"/javascript/cache\"},{\"text\":\"JS闭包\",\"link\":\"/javascript/closure\"},{\"text\":\"JS执行上下文\",\"link\":\"/javascript/context_stack\"},{\"text\":\"JS断点续传\",\"link\":\"/javascript/continue_to_upload\"},{\"text\":\"深拷贝浅拷贝\",\"link\":\"/javascript/copy\"},{\"text\":\"JS数据类型\",\"link\":\"/javascript/data_type\"},{\"text\":\"JS防抖节流\",\"link\":\"/javascript/debounce_throttle\"},{\"text\":\"DOM简介\",\"link\":\"/javascript/DOM\"},{\"text\":\"事件代理\",\"link\":\"/javascript/event_agent\"},{\"text\":\"事件循环\",\"link\":\"/javascript/event_loop\"},{\"text\":\"事件模型\",\"link\":\"/javascript/event_model\"},{\"text\":\"函数缓存\",\"link\":\"/javascript/function_cache\"},{\"text\":\"函数编程\",\"link\":\"/javascript/functional_programming\"},{\"text\":\"JS继承\",\"link\":\"/javascript/inherit\"},{\"text\":\"JS数据结构\",\"link\":\"/javascript/js_data_structure\"},{\"text\":\"JS数字精度丢失\",\"link\":\"/javascript/loss_accuracy\"},{\"text\":\"JS内存泄漏\",\"link\":\"/javascript/memory_leak\"},{\"text\":\"JS New操作\",\"link\":\"/javascript/new\"},{\"text\":\"JS原型链\",\"link\":\"/javascript/prototype\"},{\"text\":\"上拉加载，下拉刷新\",\"link\":\"/javascript/pull_up_loading_pull_down_refresh\"},{\"text\":\"JS正则表达式\",\"link\":\"/javascript/regexp\"},{\"text\":\"JS作用域\",\"link\":\"/javascript/scope\"},{\"text\":\"JS网络安全\",\"link\":\"/javascript/security\"},{\"text\":\"单点登录\",\"link\":\"/javascript/single_sign\"},{\"text\":\"字符串API\",\"link\":\"/javascript/string_api\"},{\"text\":\"JS尾递归\",\"link\":\"/javascript/tail_recursion\"},{\"text\":\"JS this\",\"link\":\"/javascript/this\"},{\"text\":\"JS类型转换\",\"link\":\"/javascript/type_conversion\"},{\"text\":\"typeof与instanceof 区别\",\"link\":\"/javascript/typeof_instanceof\"},{\"text\":\"JS判断元素可视区域\",\"link\":\"/javascript/visible\"}],\"/nodejs/\":[{\"text\":\"NodeJs简介\",\"link\":\"/nodejs/\"},{\"text\":\"Node Buffer理解\",\"link\":\"/nodejs/buffer\"},{\"text\":\"Node时间循环\",\"link\":\"/nodejs/event_loop\"},{\"text\":\"Node EventEmitter\",\"link\":\"/nodejs/event_emitter\"},{\"text\":\"Node文件上传\",\"link\":\"/nodejs/file_upload\"},{\"text\":\"Node fs模块\",\"link\":\"/nodejs/fs\"},{\"text\":\"Node全局对象\",\"link\":\"/nodejs/global\"},{\"text\":\"Node JWT\",\"link\":\"/nodejs/jwt\"},{\"text\":\"Node中间件\",\"link\":\"/nodejs/middleware\"},{\"text\":\"Node分页功能\",\"link\":\"/nodejs/paging\"},{\"text\":\"Node性能监控和优化\",\"link\":\"/nodejs/performance\"},{\"text\":\"Node process变量\",\"link\":\"/nodejs/process\"},{\"text\":\"Node模块优先级和查找\",\"link\":\"/nodejs/require_order\"},{\"text\":\"Node中流的场景\",\"link\":\"/nodejs/stream\"}],\"/react/\":[{\"text\":\"React简介\",\"link\":\"/react/\"},{\"text\":\"React动画效果\",\"link\":\"/react/animation\"},{\"text\":\"React事件绑定\",\"link\":\"/react/binding_events\"},{\"text\":\"React构建组件\",\"link\":\"/react/building_components\"},{\"text\":\"React捕获错误\",\"link\":\"/react/capture_error\"},{\"text\":\"React类和函数组件\",\"link\":\"/react/class_function_component\"},{\"text\":\"React组件通讯\",\"link\":\"/react/communication\"},{\"text\":\"React受控和非受控组件\",\"link\":\"/react/controlled_uncontrolled\"},{\"text\":\"React Diff原理\",\"link\":\"/react/diff\"},{\"text\":\"React Fiber理解\",\"link\":\"/react/fiber\"},{\"text\":\"React高阶函数\",\"link\":\"/react/high_order_components\"},{\"text\":\"React生命周期\",\"link\":\"/react/life_cycle\"},{\"text\":\"React Hooks\",\"link\":\"/react/react_hooks\"},{\"text\":\"React Refs\",\"link\":\"/react/react_refs\"},{\"text\":\"React Router\",\"link\":\"/react/react_router\"},{\"text\":\"React Router Model\",\"link\":\"/react/react_router_model\"},{\"text\":\"React渲染原理\",\"link\":\"/react/render\"},{\"text\":\"React setState\",\"link\":\"/react/set_state\"},{\"text\":\"React事件机制\",\"link\":\"/react/synthetic_event\"},{\"text\":\"state和props区别\",\"link\":\"/react/state_props\"},{\"text\":\"super()和super(props)区别\",\"link\":\"/react/super_ne_super_props\"},{\"text\":\"JSX转换真是DOM\",\"link\":\"/react/jsx_to_dom\"},{\"text\":\"for循环中的key\",\"link\":\"/react/key\"},{\"text\":\"真是DOM和虚拟DOM\",\"link\":\"/react/realdom_virtualdommd\"},{\"text\":\"不可变结构\",\"link\":\"/react/immutable\"},{\"text\":\"如何引入CSS\",\"link\":\"/react/import_css\"},{\"text\":\"性能优化\",\"link\":\"/react/improve_performance\"},{\"text\":\"渲染优化\",\"link\":\"/react/improve_render\"},{\"text\":\"Redux\",\"link\":\"/react/redux\"},{\"text\":\"Redux中间件\",\"link\":\"/react/redux_middleware\"},{\"text\":\"如何使用Redux\",\"link\":\"/react/how_to_use_redux\"},{\"text\":\"服务器端渲染\",\"link\":\"/react/server_side_rendering\"},{\"text\":\"在开发中遇到的问题\",\"link\":\"/react/summary\"}],\"/typescript/\":[{\"text\":\"TS简介\",\"link\":\"/typescript/\"},{\"text\":\"TS和JS区别\",\"link\":\"/typescript/typescript_javascript\"},{\"text\":\"TS类\",\"link\":\"/typescript/class\"},{\"text\":\"TS装饰器\",\"link\":\"/typescript/decorator\"},{\"text\":\"TS枚举\",\"link\":\"/typescript/enum\"},{\"text\":\"TS函数\",\"link\":\"/typescript/function\"},{\"text\":\"TS泛型\",\"link\":\"/typescript/generic\"},{\"text\":\"TS高级类型\",\"link\":\"/typescript/high_type\"},{\"text\":\"TS接口\",\"link\":\"/typescript/interface\"},{\"text\":\"TS命名空间\",\"link\":\"/typescript/namespace_module\"},{\"text\":\"React TS\",\"link\":\"/typescript/react\"},{\"text\":\"Vue TS\",\"link\":\"/typescript/vue\"}],\"/vue2/\":[{\"text\":\"Vue2简介\",\"link\":\"/vue2/\"},{\"text\":\"404错误分析\",\"link\":\"/vue2/404\"},{\"text\":\"Vue2 Axios\",\"link\":\"/vue2/axios\"},{\"text\":\"Vue2 Axios Code\",\"link\":\"/vue2/axioscode\"},{\"text\":\"Vue2双向绑定\",\"link\":\"/vue2/bind\"},{\"text\":\"Vue2组件间通信\",\"link\":\"/vue2/communication\"},{\"text\":\"Vue2组件插件区别\",\"link\":\"/vue2/components_plugin\"},{\"text\":\"Vue2解决跨域\",\"link\":\"/vue2/cors\"},{\"text\":\"Vue2添加属性\",\"link\":\"/vue2/data_object_add_attrs\"},{\"text\":\"Vue2 Data属性\",\"link\":\"/vue2/data\"},{\"text\":\"Vue2 Diff算法\",\"link\":\"/vue2/diff\"},{\"text\":\"Vue2 指令\",\"link\":\"/vue2/directive\"},{\"text\":\"Vue2 Restful错误处理\",\"link\":\"/vue2/error\"},{\"text\":\"Vue2过滤器\",\"link\":\"/vue2/filter\"},{\"text\":\"Vue2首屏加载\",\"link\":\"/vue2/first_page_time\"},{\"text\":\"Vue2 v-if v-for\",\"link\":\"/vue2/if_for\"},{\"text\":\"Vue2 keep-alive\",\"link\":\"/vue2/keepalive\"},{\"text\":\"Vue2 key原理\",\"link\":\"/vue2/key\"},{\"text\":\"Vue2生命周期\",\"link\":\"/vue2/lifecycle\"},{\"text\":\"Vue2 Mixin\",\"link\":\"/vue2/mixin\"},{\"text\":\"Vue2修饰符\",\"link\":\"/vue2/modifier\"},{\"text\":\"Vue2实例挂载\",\"link\":\"/vue2/new_vue\"},{\"text\":\"Vue2 NextTick\",\"link\":\"/vue2/nexttick\"},{\"text\":\"Vue2 Observable\",\"link\":\"/vue2/observable\"},{\"text\":\"Vue2权限管理\",\"link\":\"/vue2/permission\"},{\"text\":\"Vue2 v-show v-if\",\"link\":\"/vue2/show_if\"},{\"text\":\"Vue2插槽\",\"link\":\"/vue2/slot\"},{\"text\":\"SPA单页面\",\"link\":\"/vue2/spa\"},{\"text\":\"服务端渲染\",\"link\":\"/vue2/ssr\"},{\"text\":\"Vue2目录结构\",\"link\":\"/vue2/structure\"},{\"text\":\"Vue2虚拟DOM\",\"link\":\"/vue2/vnode\"},{\"text\":\"Vue2和Vue3区别\",\"link\":\"/vue2/vue3_vue2\"}],\"/vue3/\":[{\"text\":\"Vue3简介\",\"link\":\"/vue3/\"},{\"text\":\"Vue3的目标\",\"link\":\"/vue3/goal\"},{\"text\":\"Vue3遮罩层\",\"link\":\"/vue3/modal\"},{\"text\":\"Vue3性能提升\",\"link\":\"/vue3/performance\"},{\"text\":\"Vue3代理\",\"link\":\"/vue3/proxy\"},{\"text\":\"Vue3 Tree Shaking\",\"link\":\"/vue3/treeshaking\"}],\"/webpack/\":[{\"text\":\"Webpack简介\",\"link\":\"/webpack/\"},{\"text\":\"Webpack构建流程\",\"link\":\"/webpack/build_process\"},{\"text\":\"Webpack热更新\",\"link\":\"/webpack/HMR\"},{\"text\":\"提高构建速度\",\"link\":\"/webpack/improve_build\"},{\"text\":\"Webpack打包优化\",\"link\":\"/webpack/performance\"},{\"text\":\"Webpack Loader\",\"link\":\"/webpack/loader\"},{\"text\":\"Webpack Plugin\",\"link\":\"/webpack/plugin\"},{\"text\":\"Webpack Loader和Plugin区别\",\"link\":\"/webpack/loader_plugin\"},{\"text\":\"Webpack Proxy原理\",\"link\":\"/webpack/proxy\"},{\"text\":\"打包工具对比\",\"link\":\"/webpack/compare_build_tools\"}]},\"footer\":{\"message\":\"Released under the MIT License.\",\"copyright\":\"Copyright © 2023-present ZOE\"}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":true}")</script>
    
  </body>
</html>